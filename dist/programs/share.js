export async function main(ns) {
    ns.tail();
    ns.disableLog('ALL');
    const script = '/programs/dependencies/1share.js';
    let servers = ns.getPurchasedServers();
    for (let server of servers) {
        ns.killall(server);
        await ns.scp(script, 'home', server);
    }
    servers.push('home');
    servers = servers.sort(function (a, b) {
        if (a == 'home')
            return 1;
        const aN = parseInt(a.replace(/S0|S/gm, ''), 10);
        const bN = parseInt(b.replace(/S0|S/gm, ''), 10);
        return aN - bN;
    });
    ns.clearLog();
    while (true) {
        let prnt = '';
        let allThreads = 0;
        for (let server of servers) {
            const threads = Math.floor((ns.getServerMaxRam(server) - ns.getServerUsedRam(server)) / ns.getScriptRam(script));
            if (threads > 0) {
                allThreads += threads;
                ns.exec(script, server, threads);
            }
            prnt += (`\n${(server + ':').padEnd(5, ' ')} ${formatNumber(threads)} threads`);
        }
        if (allThreads > 0) {
            prnt += `\nALL:  ${formatNumber(allThreads)} threads`;
            ns.clearLog();
            ns.print(prnt);
        }
        await ns.sleep(250);
    }
    function formatNumber(num) {
        if (num >= 10 ** 12) {
            return ((num / 10 ** 12).toFixed(2) + 'q').padStart(7, ' ');
        }
        if (num >= 10 ** 9) {
            return ((num / 10 ** 9).toFixed(2) + 't').padStart(7, ' ');
        }
        if (num >= 10 ** 6) {
            return ((num / 10 ** 6).toFixed(2) + 'm').padStart(7, ' ');
        }
        if (num >= 10 ** 3) {
            return ((num / 10 ** 3).toFixed(2) + 'k').padStart(7, ' ');
        }
        return ((num).toFixed(0) + '').padStart(7, ' ');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUuanMiLCJzb3VyY2VSb290IjoiaHR0cDovL2xvY2FsaG9zdDo4MDAwL3NvdXJjZXMvIiwic291cmNlcyI6WyJwcm9ncmFtcy9zaGFyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLENBQUMsS0FBSyxVQUFVLElBQUksQ0FBQyxFQUFPO0lBQzlCLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUNULEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFcEIsTUFBTSxNQUFNLEdBQUcsa0NBQWtDLENBQUE7SUFDakQsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDLG1CQUFtQixFQUFFLENBQUE7SUFFdEMsS0FBSyxJQUFJLE1BQU0sSUFBSSxPQUFPLEVBQUU7UUFDeEIsRUFBRSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNsQixNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFDLE1BQU0sRUFBQyxNQUFNLENBQUMsQ0FBQTtLQUNyQztJQUVELE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7SUFFcEIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsSUFBSSxNQUFNO1lBQUUsT0FBTyxDQUFDLENBQUE7UUFDekIsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQzlDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBQyxFQUFFLENBQUMsRUFBQyxFQUFFLENBQUMsQ0FBQTtRQUM5QyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUE7SUFDbEIsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUE7SUFFYixPQUFPLElBQUksRUFBRTtRQUNULElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUNiLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQTtRQUNsQixLQUFLLElBQUksTUFBTSxJQUFJLE9BQU8sRUFBRTtZQUN4QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUE7WUFDaEgsSUFBSSxPQUFPLEdBQUcsQ0FBQyxFQUFFO2dCQUNiLFVBQVUsSUFBSSxPQUFPLENBQUE7Z0JBQ3JCLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFDLE1BQU0sRUFBQyxPQUFPLENBQUMsQ0FBQTthQUNqQztZQUNELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBQyxHQUFHLENBQUMsSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFBO1NBQ2pGO1FBQ0QsSUFBSSxVQUFVLEdBQUcsQ0FBQyxFQUFFO1lBQ2hCLElBQUksSUFBSSxXQUFXLFlBQVksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFBO1lBQ3JELEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQTtZQUNiLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7U0FDakI7UUFDRCxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDdEI7SUFFRCxTQUFTLFlBQVksQ0FBRSxHQUFZO1FBQy9CLElBQUksR0FBRyxJQUFJLEVBQUUsSUFBRSxFQUFFLEVBQUU7WUFBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxJQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFDLEdBQUcsQ0FBQyxDQUFBO1NBQUM7UUFDN0UsSUFBSSxHQUFHLElBQUksRUFBRSxJQUFFLENBQUMsRUFBRTtZQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFLElBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUMsR0FBRyxDQUFDLENBQUE7U0FBQztRQUMzRSxJQUFJLEdBQUcsSUFBSSxFQUFFLElBQUUsQ0FBQyxFQUFFO1lBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxHQUFHLEVBQUUsSUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBQyxHQUFHLENBQUMsQ0FBQTtTQUFDO1FBQzNFLElBQUksR0FBRyxJQUFJLEVBQUUsSUFBRSxDQUFDLEVBQUU7WUFBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxJQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFDLEdBQUcsQ0FBQyxDQUFBO1NBQUM7UUFDM0UsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUMsR0FBRyxDQUFDLENBQUE7SUFDbEQsQ0FBQztBQUVMLENBQUMifQ==