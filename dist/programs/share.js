export async function main(ns) {
    ns.tail();
    ns.disableLog('ALL');
    const script = '/programs/dependencies/1share.js';
    if (!ns.fileExists(script))
        await createSHR();
    let servers = ns.getPurchasedServers();
    for (let server of servers) {
        ns.killall(server);
        await ns.scp(script, 'home', server);
    }
    servers.push('home');
    servers = servers.sort(function (a, b) {
        if (a == 'home')
            return 1;
        const aN = parseInt(a.replace(/S0|S/gm, ''), 10);
        const bN = parseInt(b.replace(/S0|S/gm, ''), 10);
        return aN - bN;
    });
    ns.clearLog();
    while (true) {
        let prnt = '';
        let allThreads = 0;
        for (let server of servers) {
            const threads = Math.floor((ns.getServerMaxRam(server) - ns.getServerUsedRam(server)) / ns.getScriptRam(script));
            if (threads > 0) {
                allThreads += threads;
                ns.exec(script, server, threads);
            }
            prnt += (`\n${(server + ':').padEnd(5, ' ')} ${formatNumber(threads)} threads`);
        }
        if (allThreads > 0) {
            prnt += `\nALL:  ${formatNumber(allThreads)} threads`;
            ns.clearLog();
            ns.print(prnt);
        }
        await ns.sleep(250);
    }
    async function createSHR() {
        let raw = [
            'export async function main(ns) {\n',
            '    await ns.share()\n;',
            '}'
        ];
        let compiled = '';
        raw.forEach(function (a) { compiled += a; });
        await ns.write(script, compiled, 'w');
        ns.tprint('INFO: created ' + script);
    }
    function formatNumber(num) {
        if (num >= 10 ** 12) {
            return ((num / 10 ** 12).toFixed(2) + 'q').padStart(7, ' ');
        }
        if (num >= 10 ** 9) {
            return ((num / 10 ** 9).toFixed(2) + 't').padStart(7, ' ');
        }
        if (num >= 10 ** 6) {
            return ((num / 10 ** 6).toFixed(2) + 'm').padStart(7, ' ');
        }
        if (num >= 10 ** 3) {
            return ((num / 10 ** 3).toFixed(2) + 'k').padStart(7, ' ');
        }
        return ((num).toFixed(0) + '').padStart(7, ' ');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUuanMiLCJzb3VyY2VSb290IjoiaHR0cDovL2xvY2FsaG9zdDo4MDAwL3NvdXJjZXMvIiwic291cmNlcyI6WyJwcm9ncmFtcy9zaGFyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLENBQUMsS0FBSyxVQUFVLElBQUksQ0FBQyxFQUFPO0lBQzlCLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUNULEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFcEIsTUFBTSxNQUFNLEdBQUcsa0NBQWtDLENBQUE7SUFDakQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQUUsTUFBTSxTQUFTLEVBQUUsQ0FBQztJQUU5QyxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUMsbUJBQW1CLEVBQUUsQ0FBQTtJQUV0QyxLQUFLLElBQUksTUFBTSxJQUFJLE9BQU8sRUFBRTtRQUN4QixFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ2xCLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUMsTUFBTSxFQUFDLE1BQU0sQ0FBQyxDQUFBO0tBQ3JDO0lBRUQsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUVwQixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxJQUFJLE1BQU07WUFBRSxPQUFPLENBQUMsQ0FBQTtRQUN6QixNQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxDQUFDLENBQUE7UUFDOUMsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQzlDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQTtJ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